<%= stylesheet_link_tag '//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css' %>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-9">
      <h2>Portfolio (<%= number_to_currency(@balance, precision: 2) %>)</h2>
      last updated: <%= @datetime %>
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">Symbol</th>
            <th scope="col">Shares</th>
            <th scope="col">Price ($)</th>
            <th scope="col">Change ($)</th>
          </tr>
        </thead>
        <tbody>
          <% @shares.each do |stock|%>
            <% ticker = stock.ticker %>
            <% quote = @quotes[ticker.to_sym] %>
            <% latestPrice = quote.latest_price %>
            <% change = (latestPrice - quote.open).floor(2) %>
            <% color =
                change > 0 ? 'increase' :
                change < 0 ? 'decrease' :
                'nochange'%>
            <tr>
              <td class=<%= color %>><%= ticker %></td>
              <td><%= stock.num_shares %></td>
              <td class=<%= color %>><%= latestPrice.floor(2) %></td>
              <td class=<%= color %>><%= change %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="col-sm-3">
      <h3>Balance: <%= number_to_currency(current_user.cash, precision: 2) %></h3>

      <%= bootstrap_form_with(url: transactions_path, id: 'buy') do |f| %>
        <%= f.text_field :ticker, placeholder: 'Symbol', autocapitalize: 'characters', maxlength: 5, id: 'ticker', required: true %>
        
        Price per share:
        <%= f.text_field :price_per_share, hide_label: true, id: 'price-per-share', placeholder: 'Enter symbol above', readonly: true %>

        Last updated:
        <p id='last-updated'></p>

        <%= f.number_field :qty, label: 'Quantity', placeholder: 'Quantity of shares', min: 1, required: true %>

        <%= f.submit 'Purchase' %>
      <% end %>

      <div id="errors"></div>
    </div>
  </div>
</div>

<%= javascript_include_tag('//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js') %>
<%= javascript_include_tag('portfolio') %>